<!doctype html>
<html lang="zh-tw">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="兒童成長網站" />
    <meta name="description" content="兒童成長網站" />
    <title>兒童成長網站</title>
    <link rel="icon" href="src/head_icon/img-hat.ico" type="image/x-icon" />
    <!-- CSS -->
    <link rel="stylesheet" href="./css/all.css" />
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/owl.carousel.min.css" />
    <link rel="stylesheet" href="./css/owl.theme.default.css" />
  </head>
  <body>
    <div class="wrap">
      <!-- 手機板選單 -->
      <h1 class="logo-box d-flex d-md-none">
        <a class="navbar-brand logopic d-block" href="./index.html">
          <img src="./src/home/top-logo.png" alt="logo" />
        </a>
        <span>兒童成長網站</span>
      </h1>
      <div class="hb-btn-container">
        <input id="menu-toggle" type="checkbox" />
        <label class="menu-button-container" for="menu-toggle">
          <div class="menu-button"></div>
        </label>
      </div>
      <div class="phone-container position-fixed">
        <ul class="phone-list-nav p-0">
          <li><a href="./services.html">服務介紹</a></li>
          <li><a href="./member.html">會員專區</a></li>
          <li><a href="./child-list.html">兒童清單</a></li>
          <li><a href="./data-analysis.html">數據分析</a></li>
          <li><a href="./contactUs.html">聯絡我們</a></li>
          <li><a href="./daily.html">每日紀錄</a></li>
          <!-- user-login -->
          <div class="login-items d-flex">
            <!-- 已登入 -->
            <a
              href="#"
              class="login-user-box d-flex flex-column align-items-center text-decoration-none d-none"
            >
              <div class="login-item-pic">
                <img src="./src/home/login-pic.svg" alt="user-pic" />
              </div>
              <p class="user-name">使用者A</p>
            </a>
            <a
              class="login-out-box d-flex flex-column align-items-center text-decoration-none d-none"
              href="#"
              ><div class="login-item-pic">
                <img src="./src/home/logout.svg" alt="login-out-pic" />
              </div>
              <p>登出</p>
            </a>
            <!-- 未登入 -->
            <a
              class="d-flex flex-column align-items-center text-decoration-none login-box d-none"
              href="#"
              ><div class="login-item-pic">
                <img src="./src/home/person.png" alt="login-out-pic" />
              </div>
              <p>點擊登入</p>
            </a>
          </div>
        </ul>
      </div>
      <!-- 桌機板選單 -->
      <header class="main-header d-none d-md-block">
        <nav class="navbar navbar-expand-lg navbar-main">
          <div class="container-fluid p-0">
            <h1 class="logo-box d-flex">
              <a class="navbar-brand logopic d-block" href="./index.html">
                <img src="./src/home/top-logo.png" alt="logo" />
              </a>
              <span>兒童成長網站</span>
            </h1>
            <div
              class="collapse navbar-collapse top-navbar-body"
              id="navbarSupportedContent"
            >
              <ul
                class="navbar-nav top-navbar-menu mb-2 mb-lg-0 flex-wrap mx-auto"
              >
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./services.html"
                    >服務介紹<br />
                    <span>Service</span>
                  </a>
                </li>
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./member.html"
                    >會員專區<br />
                    <span>Member</span>
                  </a>
                </li>
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./child-list.html"
                    >兒童清單<br />
                    <span>Kids</span>
                  </a>
                </li>
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./data-analysis.html"
                    >數據分析<br />
                    <span>Charts</span>
                  </a>
                </li>
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./contactUs.html"
                    >聯絡我們<br />
                    <span>Contact</span>
                  </a>
                </li>
                <li class="nav-item top-navbar-item">
                  <a class="nav-link top-navbar-txt" href="./daily.html"
                    >每日紀錄<br />
                    <span>Daily</span>
                  </a>
                </li>
              </ul>
              <!-- user-login -->
              <div class="login-items d-flex">
                <!-- 已登入 -->
                <a
                  href="#"
                  class="login-user-box d-flex flex-column align-items-center text-decoration-none d-none"
                >
                  <div class="login-item-pic">
                    <img src="./src/home/login-pic.svg" alt="user-pic" />
                  </div>
                  <p class="user-name">使用者A</p>
                </a>
                <a
                  class="login-out-box d-flex flex-column align-items-center text-decoration-none d-none"
                  href="#"
                  ><div class="login-item-pic">
                    <img src="./src/home/logout.svg" alt="login-out-pic" />
                  </div>
                  <p>登出</p>
                </a>
                <!-- 未登入 -->
                <a
                  class="login-box d-flex flex-column align-items-center text-decoration-none d-none"
                  href="#"
                  ><div class="login-item-pic">
                    <img src="./src/home/person.png" alt="login-out-pic" />
                  </div>
                  <p>點擊登入</p>
                </a>
              </div>
            </div>
          </div>
        </nav>
      </header>
      <!-- 上面是Header -->
      <!-- 兒童清單 -->
      <div class="container-fluid p-0 m-0 text-secondary child_list_container">
        <div class="row margin_test justify-content-center align-items-center">
          <div class="col-12 text-center">
            <h2 class="mb-5 main_title">兒童清單</h2>
          </div>
          <div class="col-12 align-self-center mb-5">
            <div class="row" id="cardContainer">
              <div class="col-12">
                <div class="card_container">
                  <div class="row card_body">
                    <div
                      class="d-flex justify-content-center align-items-center"
                    >
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 text-center p-0 child_list_buttons mb-5">
            <a href="new-child.html">
              <button
                id="addButton"
                type="button"
                class="btn btn-primary custom_button"
              >
                <p>新增兒童 +</p>
              </button>
            </a>
          </div>
        </div>
      </div>

      <!-- footer -->
      <footer class="section-footer container-fluid position-relative">
        <div class="row">
          <div class="col-12 col-md-6">
            <div class="section-footer-item">
              <h3>兒童成長管理</h3>
              <div class="section-footer-box d-flex">
                <div class="section-footer-pic">
                  <img src="./src/home/Facebook.png" alt="fb" />
                </div>
                <div class="section-footer-pic">
                  <img src="./src/home/twitter.png" alt="tw" />
                </div>
                <div class="section-footer-pic">
                  <img src="./src/home/Instagram.png" alt="ig" />
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6 p-0">
            <div class="section-item-right">
              <ul class="d-flex flex-wrap justify-content-center p-0">
                <li><a href="./services.html">服務介紹</a></li>
                <li><a href="./member.html">會員專區</a></li>
                <li><a href="./child-list.html">兒童清單</a></li>
                <li><a href="./data-analysis.html">數據分析</a></li>
                <li><a href="./contactUs.html">聯絡我們</a></li>
                <li><a href="./daily.html">每日記錄</a></li>
              </ul>
              <div class="section-footer-join">
                <button>
                  <p>Team Project —— Join Us</p>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="footer-house position-absolute d-none d-md-block">
          <img src="./src/home/left.house.png" alt="" />
        </div>
      </footer>
      <!-- footer -->
      <section class="section-copyright">
        <p>Copyright &copy; 2023 All rights reserved.</p>
      </section>
    </div>

    <!-- Js套件 -->
    <!-- jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- owlJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <!-- bs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js"></script>
    <!-- axios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <!-- echart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <!-- grid.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gridjs/6.0.6/gridjs.production.min.js"></script>
    <!-- sweetalert2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.10.1/sweetalert2.min.js"></script>
    <!-- validate.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/validate.js/0.13.1/validate.min.js"></script>
    <!-- JS套件 -->

    <!-- 頁面JS -->
    <script src="js/json-sever/utils.js"></script>
    <script src="js/json-sever/apiGET.js"></script>
    <script src="js/json-sever/apiPOST.js"></script>
    <script src="js/json-sever/apiPATCH.js"></script>
    <script src="js/layouts.js"></script>
    <!-- menu/JS -->
    <script>
      //結合小孩資料與小孩睡眠時間資料
      async function combineKidListWithSleepTimeChartData(token, userInfo) {
        const kidListWithSleepTimeChartData = await Promise.all(
          userInfo.kids.map(async (item, index) => {
            item.sleepTimeData = await getRecentSleepTime(
              token,
              userInfo,
              index
            );
            return item;
          })
        );
        console.log("aaa", kidListWithSleepTimeChartData);
        return kidListWithSleepTimeChartData;
      }
      //渲染小孩資料
      function renderKidData(data) {
        const cardContainer = document.getElementById("cardContainer");
        let str = "";
        data.forEach((item) => {
          str += `
          <div class="col-12 mb-5">
            <div class="card_container">
              <div class="row card_body">
              
                <div class="col-12 col-xl-3 mb-5 mb-xl-0">
                  <a href="daily.html">
                    <div class="img_container">
                        <img src="./src/home/banner_2.jpg" />
                    </div>
                    <div
                      class="mt-3 text-center d-flex justify-content-center"
                    >
                      <div class="icon_container">
                        <img src="./src/home/img-hat.png" />
                      </div>
                      <p class="ml-2 align-self-center hint_text">
                        點擊圖片進入每日紀錄
                      </p>
                    </div>
                  </a>  
                  </div>
                
                <div class="col-12 col-xl-3 child_data_block">
                  <p>${item.kid_name}</p>
                  <p>身高：<span>${item.ini_height}</span>cm</p>
                  <p>體重：<span>${item.ini_weight}</span>kg</p>
                </div>
                <div class="col-12 col-xl-6">
                  <div id="chartContainer_${item.id}" class="chart_container"></div>
                </div>
              </div>
            </div>
          </div>    
          `;
        });

        cardContainer.innerHTML = str;
      }
      // 渲染小孩睡眠時間圖表
      function renderChart(chartId, data) {
        const dom = document.getElementById(chartId);
        const myChart = echarts.init(dom, "light", {
          renderer: "canvas",
          useDirtyRect: false,
        });
        const app = {};
        const ROOT_PATH = "https://echarts.apache.org/examples";
        let option;
        // const data = [
        //   ["2023-10-15", 7],
        //   ["2023-10-16", 7],
        //   ["2023-10-17", 6],
        //   ["2023-10-18", 5],
        //   ["2023-10-19", 9],
        //   ["2023-10-21", 5],
        //   ["2023-10-21", 8],
        // ];
        function creatChart(data) {
          myChart.setOption(
            (option = {
              title: {
                text: "近七天睡眠時間",
                left: "1%",
              },
              tooltip: {
                trigger: "axis",
              },
              grid: {
                left: "5%",
                right: "15%",
                bottom: "10%",
              },
              xAxis: [
                {
                  data: data.map(function (item) {
                    return item[0];
                  }),
                },
              ],
              yAxis: [
                {
                  type: "value",
                },
              ],
              dataZoom: [
                {
                  type: "inside",
                },
              ],
              visualMap: [
                {
                  type: "piecewise",
                  seriesIndex: 0,
                  top: 50,
                  right: 10,
                  pieces: [
                    {
                      min: 0,
                      max: 6.9,
                      label: "睡眠時間小於7小時",
                      color: "#FA8072",
                    },
                    {
                      min: 7,
                      max: 8.9,
                      label: "睡眠時間標準7~9小時",
                      color: "#FFC500",
                    },
                    {
                      min: 9,
                      max: 24,
                      label: "睡眠時間大於9小時",
                      color: "#32CD32",
                    }, // 表示 value 等于 123 的情况。
                  ],
                },
              ],
              series: [
                {
                  name: "睡眠時長",
                  type: "bar",
                  data: data.map(function (item) {
                    return item[1];
                  }),
                },
              ],
            })
          );
        }

        if (option && typeof option === "object") {
          myChart.setOption(option);
        }
        creatChart(data);
        window.addEventListener("resize", myChart.resize);
      }
      // 畫面渲染動作
      async function renderChildList() {
        // await login();
        // await getUserInfo();
        const kidListWithSleepTimeChartData =
          await combineKidListWithSleepTimeChartData(token, userInfo);
        await renderKidData(kidListWithSleepTimeChartData);
        await kidListWithSleepTimeChartData.map((item) => {
          const chartId = `chartContainer_${item.id}`;
          let chartData = [];
          console.log("ccc", item.sleepTimeData);
          if (item.sleepTimeData.length !== 0) {
            chartData = item.sleepTimeData.data.map((data) => {
              const result = [data.record_date, data.sleep_hours];

              return result;
            });
          }

          renderChart(chartId, chartData);
        });
      }

      // 進行畫面渲染
      renderChildList();
    </script>
    <!-- 頁面JS -->
  </body>
</html>
